/* Copyright (c) 2025 Lukoning (https://github.com/Lukoning) */

* {
    font-family: "Noto Sans SC", "Segoe UI", "Microsoft YaHei UI";
    --button-border-radius: var(--border-radius-small) !important;
    transition: background .1s, color .1s;
    --toolbar-start-end-padding: 4px !important;
    --toolbarbutton-outer-padding: 1px !important;
}

/*html:not(:has(#tabbrowser-tabbox)) {
    background-color: transparent !important;
    background-image: image-set(url("chrome://branding/content/about-logo.png"), url("chrome://branding/content/about-logo@2x.png") 2x) no-repeat center !important;
}*/


:root[taskbartab] {/*PWA*/
    #taskbar-tabs-favicon { /*(至少FF143)标题栏应用图标重新对齐*/
        margin-inline-start: 12px !important;
    }
    toolbar .customization-target > *:not(:is(
    #back-button, #forward-button, #stop-reload-button, #customizableui-special-spring1, #vertical-spacer,
    #customizableui-special-spring2, #downloads-button, #unified-extensions-button, .unified-extensions-item,
    #save-page-button, #print-button, #find-button, #zoom-controls, #edit-controls, #characterencoding-button,
    #email-link-button, #screenshot-button, #nav-bar-overflow-button, #fullscreen-button, #urlbar-container) ~ *)
    { /*工具栏左边距修复*/
        &:is(toolbarbutton), &:is(toolbaritem) > toolbarbutton {
            padding-inline-start: var(--toolbar-start-end-padding) !important;
        }
    }
}

/*对话框居中修复*/
.dialogStack:not(.content-prompt-dialog),#window-modal-dialog/*这是？*/
.dialogOverlay {
    height: 100% !important;
    width: 100% !important;
    & .dialogBox {
        margin: auto !important;
    }
}
#window-modal-dialog {/*你都居中了，那就一起居中吧!*/
    height: 100% !important;
    width: 100% !important;
}

toolbar { /*缩小工具栏按钮之间的距离*/
    .toolbarbutton-1 {
        --toolbarbutton-outer-padding: 0 !important;
    }
    .toolbaritem-combined-buttons {
        margin-inline: 0 !important;
    }
} 
#PanelUI-menu-button:not(#navigator-toolbox:not([tabs-hidden]) *):not(html:not([customtitlebar]) *)
{ /*应用程序菜单按钮*/
    padding-inline-end: 0 !important;
}

.titlebar-buttonbox { /*三大金刚*/
    min-height: 25px;
    padding: 5px 4px 4px 0 !important;
    toolbarbutton {
        padding: 0 11px !important;
        border-radius: var(--border-radius-small);
        &::before {
            transform: translateY(1px);
        }
        /*&::after {
            content: "";
            position: absolute;
            inset: 0;
            z-index: -1;
            width: 34px;
        }*/
    }
}
:root[fxastatus="signedin"] #fxa-toolbar-menu-button .avatar-container { /*工具栏账户按钮*/
    scale: 1.3; /*使其与其他工具栏图标在视觉上大小一致*/
}

.private-browsing-indicator-with-label { /*“隐私浏览”标记*/
    margin-inline: 8px !important;
    .private-browsing-indicator-label {
        margin: 2px 0 0 4px !important;
    }
}

#urlbar-container * {
    transition: all .2s, background .1s, color .1s;
}
#urlbar-searchmode-switcher {
    height: 28px !important;
}

.tab-background { /*标签页背景*/
    border-radius: var(--border-radius-small) !important;
}
:root:not([privatebrowsingmode]) :is(toolbarbutton, toolbarpaletteitem) ~ #tabbrowser-tabs
, :root[privatebrowsingmode] :is(toolbarbutton:not(#firefox-view-button)
, toolbarpaletteitem:not(#wrapper-firefox-view-button)) ~ #tabbrowser-tabs { /*隐藏分割线*/
    border-inline-start: none !important;
    padding-inline-start: 1px !important;
    margin-inline-start: 0 !important;
}
#tabbrowser-tabs {/*标签页*/
    &[orient="vertical"] { /*垂直标签页*/
        .tab-background {
            /*margin-block: 0 !important; /*缩小边距1*/
            /*min-height: 0 !important; /*紧凑化*/
        }
        .tabbrowser-tab {
            padding-block: 0 !important; /*缩小边距2*/
        }
        &{ /*新标签页按钮*/
            #tabs-newtab-button { /*溢出前新标签页按钮
                margin-block: 0 !important;*/
                image {
                    transform: translateY(-1px);
                }
            }
            #vertical-tabs-newtab-button {/* 溢出后新标签页按钮
                margin-block: -4px -3px !important;*/
                label {
                    transform: translateY(1px);
                }
            }
        }
        #tabbrowser-arrowscrollbox {
            &::part(scrollbutton-up), &::part(scrollbutton-down) { /*显示溢出箭头(无用)*/
                display: flex !important;
            }
        }
    }
}
#sidebar-main[sidebar-positionend] {
    #tabbrowser-tabs {
        .tabbrowser-tab[visuallyselected] .tab-background {
            border-left: none;
            border-right: 2px solid AccentColor;/*右侧垂直标签页右边框*/
        }
    }
}

#tabbrowser-arrowscrollbox[orient="vertical"] {
    &::part(scrollbutton-up), &::part(scrollbutton-down) {
        display: flex !important;
    }
}

#tabbrowser-arrowscrollbox[orient="vertical"] > #tabbrowser-arrowscrollbox-periphery > #tabs-newtab-button, #vertical-tabs-newtab-button {
    border-radius: 4px !important;
}

/*带侧边栏时网页内容边角*/
:root:not([inDOMFullscreen], [inFullscreen]:not([macOSNativeFullscreen]), [taskbartab]) {
    #browser:has(#sidebar-main:not([hidden]:not([sidebar-panel-open]))) {
        &:not(:has(#sidebar-main[sidebar-positionend])) #tabbrowser-tabbox {
            border-top-left-radius: var(--border-radius-medium);
            tabpanels, browser {
                clip-path: rect(0 100% 100% 0 round 8px 0 0 0);
            }
        }
        &:has(#sidebar-main[sidebar-positionend]) #tabbrowser-tabbox {
            border-top-right-radius: var(--border-radius-medium);
            tabpanels, browser {
                clip-path: rect(0 100% 100% 0 round 0 8px 0 0);
            }
        }
    }
}

/*#TabsToolbar, #toolbar-menubar {
    padding: 0 calc(var(--toolbar-start-end-padding) - var(--toolbarbutton-outer-padding)) !important;
    .titlebar-buttonbox-container {
        transform: translateX(calc(var(--toolbar-start-end-padding) - var(--toolbarbutton-outer-padding)));
    }
}*/
&{ /*菜单栏*/
    #toolbar-menubar {
        height: 0 !important;
        transition: opacity var(--inactive-window-transition), min-height .1s !important;
        &:not([autohide][inactive]) {
            min-height: 41px !important;
        };
        > :is(toolbarbutton, toolbaritem):first-child {
            padding-inline-start: var(--toolbar-start-end-padding) !important;
        }
    }
    #menubar-items {
        padding: 0 var(--toolbarbutton-outer-padding);
        menubar {
            height: 100%;
            margin: 5px 0 0 0;
            max-height: 30px;
            menu {
                margin: 0 2px
            }
        }
    }
}
#TabsToolbar { /*水平标签页工具栏*/
    &{ /*高度修改*/
        margin-bottom: -5px !important;
        max-height: 41px !important;
        #TabsToolbar-customization-target {
            transform: translateY(1px);
        }
    }
    .titlebar-spacer[type="pre-tabs"] { /*去掉空白*/
        display: none !important;
    }
    #TabsToolbar-customization-target {
        > :is(toolbarbutton, toolbaritem):first-child {
            padding-inline-start: 1px !important;
        }
    }
}
#nav-bar-customization-target {/*垂直标签页+最大化时整个顶栏的顶部都能拖，与 MS Edge 的行为一致*/
    border-top: 1px solid transparent !important;
}
#nav-bar {/*隐藏掉奇怪的线*/
    border-top: none !important;
}

/*标签页切换动画*/
@keyframes documentIn {
    0% {
        transform: translateY(100px);
        opacity: 0;
    }
    100% {
        opacity: 1;
        transform: translateY(0px);
    }
}
@keyframes documentOut {
    100% {
        transform: translateY(100px);
        opacity: 0;
    }
    0% {
        opacity: 1;
        transform: translateY(0px);
    }
}
#tabbrowser-tabbox hbox.browserSidebarContainer, #customization-container {
    background-color: color-mix(in oklch, var(--tabpanel-background-color) 35%, transparent) !important;
    /*animation: documentOut .3s cubic-bezier(.34, .68, 0, 1);*/
    &.deck-selected {
        animation: documentIn .3s cubic-bezier(.34, .68, 0, 1);
    }
}

html#main-window #navigator-toolbox {
	border-bottom: none !important;
    transition: margin-top .4s cubic-bezier(.34, .68, 0, 1), background .1s;
}
#PersonalToolbar {
    padding-inline: 2px;
    opacity: 1 !important;
    transition: max-height .5s cubic-bezier(.34, .68, 0, 1), opacity .4s, background .1s; /*出现*/
    &[collapsed="true"] { /*隐藏时*/
        visibility: visible !important;
        opacity: 0.001 !important;
        transition: max-height .3s cubic-bezier(.34, .68, 0, 1), opacity .2s, background .1s; /*消失*/
    }
}

menu, menuitem, menucaption {
    border-radius: var(--border-radius-small) !important;
}

/*vbox#sidebar-box { 侧边栏应用
    min-width: min(340px, 35%) !important;
    width: 0 !important;
    transition: min-width .3s cubic-bezier(.34, .68, 0, 1), background .1s;
    &[hidden] {
        display: block;
        min-width: 0 !important;
        padding: 0 !important;
        margin: 0 !important;
        opacity: 0;
    }
    stack {
        width: calc(min(340px, 35%) - var(--space-small)) !important;
    }
    browser#sidebar {
        background-color: color-mix(in oklch, -moz-sidebar 35%, transparent) !important;
    }
}*/
:root { /*侧边栏应用 v2*/
    --lukoning-sidebar-box-width: max(min(340px, 25vw), 220px);
    #sidebar-splitter.sidebar-splitter {
        display: none !important;
    }
    #sidebar-box {
        min-width: 0 !important;
        width: 0 !important;
        &[hidden] {
            display: none;
            margin: 0 !important;
            opacity: 0;
        }
        stack {
            width: var(--lukoning-sidebar-box-width) !important;
        }
    }
    #browser:not(:has(#sidebar-main[sidebar-positionend])) #sidebar-box {
        padding-right: 0 !important; /*左侧时与网页的边距*/
    }
    #browser:has(#sidebar-main[sidebar-positionend]) #sidebar-box {
        transform: translateX(calc(var(--lukoning-sidebar-box-width) * -1));
        margin-left: 0 !important; /*右侧时与网页的边距(居然与左侧的不统一…)*/
    }
    #tabbrowser-tabbox {
        transform: translateX(0);
        transition: transform .4s cubic-bezier(.34, .68, 0, 1);
    }
    #browser:has(#sidebar-box:not([hidden])) {
        #tabbrowser-tabbox {
            transform: translateX(round(calc(var(--lukoning-sidebar-box-width) + 6px), 1px));
        }
        &:has(#sidebar-main[sidebar-positionend]) #tabbrowser-tabbox {
            transform: translateX(round(calc(-1 * var(--lukoning-sidebar-box-width) - 6px), 1px));
        }
    }
}
:root[sidebar-expand-on-hover] {
    &{ /*FF141.0 开关侧边栏时 新侧边栏功能性按钮组高度异常*/
        #sidebar-main[sidebar-ongoing-animations] {
            &:not([sidebar-launcher-expanded]):not(:has(button-group.actions-list.overflow-button)) { /*关*/
                padding-bottom: 44.8px !important;
            }
        }
    }
    #tabbrowser-tabs[orient="vertical"] {
        &:not([expanded]) { /*垂直标签页收起时标签闪烁问题*/
            .tab-background {
                width: auto !important;
            }
            stack.tab-icon-stack {
                width: 23.5px;
            }
            .tab-label-container {
                display: flex !important;
            }
        }
    }
}
@media (-moz-windows-accent-color-in-titlebar) or (-moz-windows-mica) {
    /*Mica下边栏展开 v1
    :root[sidebar-expand-on-hover] {
        #sidebar-main {
            --b-c-b: var(--background-color-box);
            transition: backdrop-filter .4s, background 0;
            backdrop-filter: blur(0px);
            &[sidebar-launcher-expanded], &[sidebar-ongoing-animations]:not([sidebar-launcher-expanded]) {
                backdrop-filter: blur(32px) contrast(1.6);
                &:not([sidebar-positionend]) {
                    background: linear-gradient(to right, var(--b-c-b) 20%, color-mix(in oklch, var(--b-c-b) 70%, transparent) 100%)  !important;
                }
                &[sidebar-positionend] {
                    background: linear-gradient(to left, var(--b-c-b) 20%, color-mix(in oklch, var(--b-c-b) 70%, transparent) 100%)  !important;
                }
            }
        }
    }*/
}

/*边栏展开 v2*/
:root[sidebar-expand-on-hover] {
    #sidebar-launcher-splitter.sidebar-splitter {
        display: none !important;
    }
    --lukoning-sidebar-width: 51.2333px;
    --sidebar-launcher-collapsed-width: var(--lukoning-sidebar-width) !important;
    #sidebar-main {
        min-width: var(--lukoning-sidebar-width) !important;
        width: 0 !important;
        transition: min-width .4s cubic-bezier(.34, .68, 0, 1), background .1s;
        &[sidebar-ongoing-animations] * {
            scrollbar-width: none;
        }
    }
    body:not(:has(vbox#sidebar-box:not([hidden]))) /*侧边栏应用打开时禁止展开，适用挤压式展开*/
    #sidebar-main[sidebar-launcher-expanded] {
        min-width: max(220px, min(320px, 20vw)) !important;
    }
    &{ /*悬浮式展开
        #sidebar-main {
            --b-c-b: var(--background-color-box);
            backdrop-filter: blur(0px);
            &[sidebar-launcher-expanded], &[sidebar-ongoing-animations]:not([sidebar-launcher-expanded]) {
                backdrop-filter: blur(32px) contrast(1.6);
                &:not([sidebar-positionend]) {
                    background: linear-gradient(to right, var(--b-c-b) 20%, color-mix(in oklch, var(--b-c-b) 70%, transparent) 100%) !important;
                }
                &[sidebar-positionend] {
                    background: linear-gradient(to left, var(--b-c-b) 20%, color-mix(in oklch, var(--b-c-b) 70%, transparent) 100%) !important;
                }
            }
        }*/
    }
    &{ /*挤压式展开 v2*/
        #sidebar-main {
            border: none !important;
            background: transparent !important;
            .tabbrowser-tab{
                max-width: none !important;
            }
            &[sidebar-launcher-expanded] {
                transition: min-width .5s cubic-bezier(.34, .68, 0, 1), background .1s;
            }
        }
        #tabbrowser-tabbox {
            transform: translateX(0);
            transition: transform .5s cubic-bezier(.34, .68, 0, 1);
            &:is(#browser:has(#sidebar-main[sidebar-launcher-expanded]):not(:has(#sidebar-box:not([hidden]))) *) {
                transform: translateX(round(calc(max(220px, min(320px, 20vw)) - 50px), 1px));
                transition: transform .4s cubic-bezier(.34, .68, 0, 1);
                &:is(#browser:has(#sidebar-main[sidebar-positionend]) *) {
                    transform: translateX(round(calc((max(220px, min(320px, 20vw)) - 50px) * -1), 1px));
                }
            }
        }
    }
    &{ /*挤压式展开 v2 优化版 优化个鬼！谁特么加动画加的脚本动画
        #sidebar-main {
            border: none !important;
            transition: background .1s !important;
            animation: none !important;
            z-index: 0;
            > html:sidebar-main {
                animation: none !important;
            }
            .tabbrowser-tab {
                max-width: none !important;
                &[visuallyselected] {
                    min-width: 51.2333px !important;
                    width: 0 !important;
                    transition: min-width .4s cubic-bezier(.34, .68, 0, 1), background .1s;
                }
            }
            &[sidebar-launcher-expanded], &[sidebar-ongoing-animations] {
                min-width: max(220px, min(320px, 20vw)) !important;
                width: max(220px, min(320px, 20vw)) !important;
                max-width: max(220px, min(320px, 20vw)) !important;
                &[sidebar-launcher-expanded] .tabbrowser-tab[visuallyselected] {
                    min-width: max(220px, min(320px, 20vw)) !important;
                }
            }
        }
        #tabbrowser-tabbox {
            transform: translateX(0);
            transition: transform .4s cubic-bezier(.34, .68, 0, 1);
            z-index: 10;
        }
        #browser:has(#sidebar-main[sidebar-launcher-expanded]):not(:has(#sidebar-box:not([hidden]))) {
            #tabbrowser-tabbox {
                transform: translateX(round(calc(max(220px, min(320px, 20vw)) - 50px), 1px));
            }
            &:has(#sidebar-main[sidebar-positionend]) #tabbrowser-tabbox {
                transform: translateX(round(calc((max(220px, min(320px, 20vw)) - 50px) * -1), 1px));
            }
        }*/
    }
}

/*部分文本去掉省略号*/
:is(label, description)[value][crop]::before {
    text-overflow: clip;
}
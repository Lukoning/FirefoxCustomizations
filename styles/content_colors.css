/* Copyright (c) 2025 Lukoning (https://github.com/Lukoning) */

/*
**  browser.tabs.allow_transparent_browser = true;
**  browser.theme.native-theme = true;
**  widget.non-native-theme.use-theme-accent = true;
**  widget.windows.mica = true;
**  widget.windows.mica.popups = 2;
**  widget.windows.mica.toplevel-backdrop = 1;（ 0 为 MicaAlt，1 为 Mica，2 为 Acrylic ）
**
**  以下内容建议在 about:config 调整到以上设置且使用主题“系统主题—自动”后食用。
**  如想更换其他主题，请关闭 widget.windows.mica 。
*/

html, body {
    color: light-dark(#1A1A1A, #FFF);
    accent-color: AccentColor;
    /*background-color: transparent;
    注释掉是因为
    在 browser.tabs.allow_transparent_browser 和 widget.windows.mica 为 true 时
    这个值默认就是 transparent ……*/
    ::selection {
        color: currentColor;
        background: light-dark(
            color-mix(in oklch, var(--color-accent-primary) 30%, transparent),
            color-mix(in oklch, var(--color-accent-primary) 40%, transparent)
        );
    }
}

@-moz-document url-prefix(about:), url-prefix(chrome:) {
    :root, html, body, window {
        background-color: transparent !important;
        &, * {
            /*--background-color-canvas: transparent !important;*/
            font-family: "Noto Sans SC", "Segoe UI", "Microsoft YaHei UI";
            --button-border-radius: var(--border-radius-small) !important;
            transition: background .1s, color .1s;
            --color-accent-primary: light-dark(
                oklch(from AccentColor calc(l * 0.9) calc(c * 1.2) h),
                oklch(from AccentColor calc(l * 1.3) calc(c * 1.2) h)
            );
            --color-accent-primary-hover: color-mix(in oklch, white 15%, var(--color-accent-primary));
            --color-accent-primary-active: color-mix(in oklch, black 10%, var(--color-accent-primary));
            accent-color: var(--color-accent-primary);
            --button-text-color: currentColor;
            --button-text-color-primary: light-dark(white, black);
            --button-text-color-primary-hover: var(--button-text-color-primary);
            --button-text-color-primary-active: color-mix(in oklch, transparent 30%, var(--button-text-color-primary));
            --button-background-color: light-dark(
                color-mix(in oklch, currentColor 10%, transparent),
                color-mix(in oklch, currentColor 15%, transparent)
            );
            --button-background-color-hover: light-dark(
                color-mix(in oklch, currentColor 5%, transparent),
                color-mix(in oklch, currentColor 10%, transparent)
            );
            --button-background-color-active: light-dark(
                color-mix(in oklch, var(--color-accent-primary) 20%, transparent),
                color-mix(in oklch, var(--color-accent-primary) 30%, transparent)
            );
            --button-background-color-primary: var(--color-accent-primary);
            --button-background-color-primary-hover: var(--color-accent-primary-hover);
            --button-background-color-primary-active: var(--color-accent-primary-active);
            --button-background-color-ghost: transparent;
            --button-background-color-ghost-hover: var(--button-background-color);
            --button-background-color-ghost-active: var(--button-background-color-active);
            --in-content-primary-button-text-color: var(--button-text-color-primary);
            --in-content-primary-button-text-color-hover: var(--button-text-color-primary);
            --in-content-primary-button-text-color-active: var(--button-text-color-primary);
            --in-content-primary-button-background: var(--color-accent-primary);
            --in-content-primary-button-background-hover: var(--color-accent-primary-hover);
            --in-content-primary-button-background-active: var(--color-accent-primary-active);
            --in-content-item-hover: color-mix(in oklch, var(--color-accent-primary) 15%, transparent);
            --in-content-item-hover-text: var(--button-text-color);
            --in-content-item-selected: light-dark(
                color-mix(in oklch, var(--color-accent-primary) 30%, transparent),
                color-mix(in oklch, var(--color-accent-primary) 40%, transparent)
            );
            --in-content-item-selected-text: var(--button-text-color);
            --in-content-table-header-color: var(--button-text-color-primary);
            --in-content-table-header-background: var(--color-accent-primary);
            --color-white: #FFF;
            --color-gray-80: #1A1A1A;
            --focus-outline: var(--focus-outline-width) solid var(--color-accent-primary) !important;
            --in-content-focus-outline-color: var(--color-accent-primary) !important;
            --link-color: var(--color-accent-primary);
            --link-color-hover: var(--color-accent-primary-hover);
            --link-color-active: var(--color-accent-primary-active);
            --link-color-visited: oklch(from var(--color-accent-primary) l c calc(h + 80));
            --in-content-page-background: transparent !important;
            --fxview-background-color: transparent !important;
            --in-content-box-info-background: transparent !important;
            --panel-background: light-dark(var(--color-white), var(--color-gray-80)) !important;
            /*--background-color-box: color-mix(in oklch, var(--panel-background) 35%, transparent) !important;
            --newtab-background-color-secondary: var(--color-gray-80) !important;*/
            transition: background .1s, color .1s;
            ::selection {
                color: var(--button-text-color);
                background: light-dark(
                    color-mix(in oklch, var(--color-accent-primary) 30%, transparent),
                    color-mix(in oklch, var(--color-accent-primary) 40%, transparent)
                ) !important;
            }
        }
    }
    .dialogBox {
        background-color: var(--panel-background) !important;
    }
    .sticky-container, .sticky-inner-container {
        pointer-events: none !important;
        &, > * {
            background-color: transparent !important;
        }
        > *:not(.sticky-inner-container) {
            pointer-events: auto !important;
            width: fit-content !important;
        }
    }
    @-moz-document url-prefix(about:config) {
        #toolbar {
            background-color: transparent !important;
            backdrop-filter: blur(4px);
        }
    }
    @-moz-document url-prefix(about:firefoxview) {
        .sticky-container {
            pointer-events: auto !important;
            flex-direction: unset !important;
            backdrop-filter: blur(10px);
            padding-bottom: 5px !important;
        }
    }
    @-moz-document url-prefix(about:preferences) {
        * {
            --panel-background: var(--background-color-canvas) !important;
        }
        /*.sticky-container {
            background: transparent !important;
        }*/
    }
}

@-moz-document regexp("^\\w+:\\/\\/[^?]*\\.[pP][dD][fF](?:\\?.*)?$|^[^:?]*\\.[pP][dD][fF](?:\\?.*)?$") {
/*PDF阅读器*/ /*这里正则表达式的转义反斜杠需要二次转义*/
    :root, html, body, window {
        background-color: transparent !important;
        * {
            --toolbar-bg-color: transparent !important;
            --sidebar-toolbar-bg-color: transparent !important;
            --progressBar-color: AccentColor !important;
        }
        .toolbarField:focus {
            border-color: AccentColor !important;
        }
    }
}